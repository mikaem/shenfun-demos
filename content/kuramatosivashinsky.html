

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Demo - Kuramato-Sivashinsky equation &#8212; Shenfun executable demos</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "mikaem/shenfun-demos");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ðŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"TeX": {"Macros": {"bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}, "extensions": ["cancel.js", "AMSmath.js"]}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/kuramatosivashinsky';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Demo - Stokes equations" href="stokes.html" />
    <link rel="prev" title="Demo - Helmholtz equation on the unit sphere" href="sphericalhelmholtz.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/seashell3.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/seashell3.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Shenfun executable demos
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Shenfun executable demos</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="poisson.html">Demo - 1D Poissonâ€™s equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="kleingordon.html">Demo - Cubic nonlinear Klein-Gordon equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="poisson3d.html">Demo - 3D Poissonâ€™s equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="polarhelmholtz.html">Demo - Helmholtz equation in polar coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphericalhelmholtz.html">Demo - Helmholtz equation on the unit sphere</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Demo - Kuramato-Sivashinsky equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="stokes.html">Demo - Stokes equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="drivencavity.html">Demo - Lid driven cavity</a></li>
<li class="toctree-l1"><a class="reference internal" href="rayleighbenard.html">Demo - Rayleigh Benard</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Demo - Working with Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="surfaceintegration.html">Demo - Integration of functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="moebius.html">Demo - Eigenvalues on the MÃ¶bius strip</a></li>
<li class="toctree-l1"><a class="reference internal" href="mixingbases.html">Demo - Mixed bases for the Helmholtz problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="tau.html">Demo - The Tau method</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparsity.html">Demo - Sparse Chebyshev-Petrov-Galerkin methods for differentiation</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/mikaem/shenfun-demos/master?urlpath=tree/content/kuramatosivashinsky.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>



<a href="https://github.com/mikaem/shenfun-demos" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/kuramatosivashinsky.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Demo - Kuramato-Sivashinsky equation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-kuramato-sivashinsky-equation">The Kuramato-Sivashinsky equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-galerkin-method">Spectral Galerkin method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretization">Discretization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <!-- File automatically generated using DocOnce (https://github.com/doconce/doconce/):
doconce format ipynb kuramatosivashinsky.do.txt  -->
<section class="tex2jax_ignore mathjax_ignore" id="demo-kuramato-sivashinsky-equation">
<h1>Demo - Kuramato-Sivashinsky equation<a class="headerlink" href="#demo-kuramato-sivashinsky-equation" title="Permalink to this heading">#</a></h1>
<p><strong>Mikael Mortensen</strong> (email: <code class="docutils literal notranslate"><span class="pre">mikaem&#64;math.uio.no</span></code>), Department of Mathematics, University of Oslo.</p>
<p>Date: <strong>April 13, 2018</strong></p>
<p><strong>Summary.</strong> This is a demonstration of how the Python module <a class="reference external" href="https://github.com/spectralDNS/shenfun">shenfun</a> can be used to solve the time-dependent,
nonlinear Kuramato-Sivashinsky equation, in a doubly periodic domain. The demo is implemented in
a single Python file <a class="reference external" href="https://github.com/spectralDNS/shenfun/blob/master/demo/Kuramato_Sivashinsky.py">KuramatoSivashinsky.py</a>, and it may be run
in parallel using MPI.</p>
<!-- dom:FIGURE: [https://rawgit.com/spectralDNS/spectralutilities/master/movies/Kuramato_movie_128.gif] Movie showing the evolution of the solution of the Kuramato-Sivashinsky equation. -->
<!-- begin figure -->
<p><img src="https://rawgit.com/spectralDNS/spectralutilities/master/movies/Kuramato_movie_128.gif" ><p style="font-size: 0.9em"><i>Figure 1: Movie showing the evolution of the solution of the Kuramato-Sivashinsky equation.</i></p></p>
<!-- end figure --><section id="the-kuramato-sivashinsky-equation">
<h2>The Kuramato-Sivashinsky equation<a class="headerlink" href="#the-kuramato-sivashinsky-equation" title="Permalink to this heading">#</a></h2>
<p>The Kuramato-Sivashinsky (KS) equation is known for its chaotic bahaviour, and it is
often used in study of turbulence or turbulent combustion. We will here solve
the KS equation in a doubly periodic domain <span class="math notranslate nohighlight">\([-30\pi, 30\pi]^2\)</span>, starting from a
single Gaussian pulse</p>
<!-- Equation labels as ordinary links -->
<p><a id="eq:ks"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{\partial u(\boldsymbol{x},t)}{\partial t} + \nabla^2 u(\boldsymbol{x},t) + \nabla^4
u(\boldsymbol{x},t) + |\nabla u(\boldsymbol{x},t)|^2 = 0 \quad \text{for }\, \boldsymbol{x} \in \Omega=[-30 \pi, 30\pi]^2
\label{eq:ks} \tag{1} 
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<p><a id="_auto1"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u(\boldsymbol{x}, 0) = \exp(-0.01 \boldsymbol{x} \cdot \boldsymbol{x}) \notag
\label{_auto1} \tag{2}
\end{equation}
\]</div>
</section>
<section id="spectral-galerkin-method">
<h2>Spectral Galerkin method<a class="headerlink" href="#spectral-galerkin-method" title="Permalink to this heading">#</a></h2>
<p><a id="sec:spectralgalerkin"></a>
The PDE in (<span class="xref myst">1</span>) can be solved with many different
numerical methods. We will here use the <a class="reference external" href="https://github.com/spectralDNS/shenfun">shenfun</a> software and this software makes use of
the spectral Galerkin method. Being a Galerkin method, we need to reshape the
governing equations into proper variational forms, and this is done by
multiplying  (<span class="xref myst">1</span>) with the complex conjugate of a proper
test function and then integrating
over the domain. To this end we use testfunction <span class="math notranslate nohighlight">\(v\in W^N(\Omega)\)</span>, where <span class="math notranslate nohighlight">\(W^N(\Omega)\)</span>
is a suitable function space (defined in Eq. (<span class="xref myst">7</span>)), and obtain</p>
<!-- Equation labels as ordinary links -->
<p><a id="eq:du_var"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{\partial}{\partial t} \int_{\Omega} u\, \overline{v}\, w \,dx = -\int_{\Omega}
\left(\nabla^2 u + \nabla^4 u \ + |\nabla u|^2 \right) \overline{v} \, w \,dx.
\label{eq:du_var} \tag{3}
\end{equation}
\]</div>
<p>Note that the overline is used to indicate a complex conjugate, whereas <span class="math notranslate nohighlight">\(w\)</span>
is a weight function. The function <span class="math notranslate nohighlight">\(u\)</span>
is now to be considered a trial function, and the integrals over the
domain are often referred to as inner products. With inner product notation</p>
<div class="math notranslate nohighlight">
\[
\left(u, v\right) = \int_{\Omega} u \, \overline{v} \, w \, dx.
\]</div>
<p>the variational problem can be formulated as</p>
<!-- Equation labels as ordinary links -->
<p><a id="eq:du_var2"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{\partial}{\partial t} (u, v) = -\left(\nabla^2 u + \nabla^4 u + |\nabla u|^2,
v \right). \label{eq:du_var2} \tag{4}
\end{equation}
\]</div>
<p>The space and time discretizations are
still left open. There are numerous different approaches that one could take for
discretizing in time. Here we will use a fourth order exponential Runge-Kutta
method.</p>
</section>
<section id="discretization">
<h2>Discretization<a class="headerlink" href="#discretization" title="Permalink to this heading">#</a></h2>
<p>We discretize the model equation in space using continuously differentiable
Fourier basis functions</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto2"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\phi_l(x) = e^{\imath \underline{l} x}, \quad -\infty &lt; l &lt; \infty,
\label{_auto2} \tag{5}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(l\)</span> is the wavenumber, and <span class="math notranslate nohighlight">\(\underline{l}=\frac{2\pi}{L}l\)</span> is the scaled wavenumber, scaled with domain
length <span class="math notranslate nohighlight">\(L\)</span> (here <span class="math notranslate nohighlight">\(60\pi\)</span>). Since we want to solve these equations on a computer, we need to choose
a finite number of test functions. A discrete function space <span class="math notranslate nohighlight">\(V^N\)</span> can be defined as</p>
<!-- Equation labels as ordinary links -->
<p><a id="eq:Vn"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
V^N(x) = \text{span} \{\phi_l(x)\}_{l\in \boldsymbol{l}}, \label{eq:Vn} \tag{6}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is chosen as an even positive integer and <span class="math notranslate nohighlight">\(\boldsymbol{l} = (-N/2,
-N/2+1, \ldots, N/2-1)\)</span>. And now, since <span class="math notranslate nohighlight">\(\Omega\)</span> is a
two-dimensional domain, we can create a tensor product of two such one-dimensional
spaces:</p>
<!-- Equation labels as ordinary links -->
<p><a id="eq:Wn"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
W^{\boldsymbol{N}}(x, y) = V^N(x) \otimes V^N(y), \label{eq:Wn} \tag{7}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{N} = (N, N)\)</span>. Obviously, it is not necessary to use the
same number (<span class="math notranslate nohighlight">\(N\)</span>) of basis functions for each direction, but it is done here
for simplicity. A 2D tensor product basis function is now defined as</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto3"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\Phi_{lm}(x,y) = e^{\imath \underline{l} x} e^{\imath \underline{m} y}
= e^{\imath (\underline{l}x + \underline{m}y )},
\label{_auto3} \tag{8}
\end{equation}
\]</div>
<p>where the indices for <span class="math notranslate nohighlight">\(y\)</span>-direction are <span class="math notranslate nohighlight">\(\underline{m}=\frac{2\pi}{L}m\)</span>, and
<span class="math notranslate nohighlight">\(\boldsymbol{m}\)</span> is the same set as <span class="math notranslate nohighlight">\(\boldsymbol{l}\)</span> due to using the same number of basis functions for each direction. One
distinction, though, is that for the <span class="math notranslate nohighlight">\(y\)</span>-direction expansion coefficients are only stored for
<span class="math notranslate nohighlight">\(m=(0, 1, \ldots, N/2)\)</span> due to Hermitian symmetry (real input data).</p>
<p>We now look for solutions of the form</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto4"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u(x, y) = \sum_{l=-N/2}^{N/2-1}\sum_{m=-N/2}^{N/2-1}
\hat{u}_{lm} \Phi_{lm}(x,y).
\label{_auto4} \tag{9}
\end{equation}
\]</div>
<p>The expansion coefficients <span class="math notranslate nohighlight">\(\hat{u}_{lm}\)</span> can be related directly to the solution <span class="math notranslate nohighlight">\(u(x,
y)\)</span> using Fast Fourier Transforms (FFTs) if we are satisfied with obtaining
the solution in quadrature points corresponding to</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto5"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
 x_i = \frac{60 \pi i}{N}-30\pi \quad \forall \, i \in \boldsymbol{i},
\text{where}\, \boldsymbol{i}=(0,1,\ldots,N-1), 
\label{_auto5} \tag{10}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<p><a id="_auto6"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
 y_j = \frac{60 \pi j}{N}-30\pi \quad \forall \, j \in \boldsymbol{j},
\text{where}\, \boldsymbol{j}=(0,1,\ldots,N-1).
\label{_auto6} \tag{11}
\end{equation}
\]</div>
<p>Note that these points are different from the standard (like <span class="math notranslate nohighlight">\(2\pi j/N\)</span>) since
the domain
is set to <span class="math notranslate nohighlight">\([-30\pi, 30\pi]^2\)</span> and not the more common <span class="math notranslate nohighlight">\([0, 2\pi]^2\)</span>. We now have</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto7"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{u} =
\mathcal{F}_x^{-1}\left(\mathcal{F}_y^{-1}\left(\boldsymbol{\hat{u}}\right)\right),
\label{_auto7} \tag{12}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{u} = \{u(x_i, y_j)\}_{(i,j)\in \boldsymbol{i} \times \boldsymbol{j}}\)</span>,
<span class="math notranslate nohighlight">\(\boldsymbol{\hat{u}} = \{\hat{u}_{lm}\}_{(l,m)\in \boldsymbol{l} \times \boldsymbol{m}}\)</span>
and <span class="math notranslate nohighlight">\(\mathcal{F}_x^{-1}\)</span> is the inverse Fourier transform along direction
<span class="math notranslate nohighlight">\(x\)</span>, for all indices in the other direction. Note that the two
inverse FFTs are performed sequentially, one direction at the time, and that
there is no scaling factor due
the definition used for the inverse
<a class="reference external" href="https://mpi4py-fft.readthedocs.io/en/latest/dft.html">Fourier transform</a>:</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto8"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u(x_j) = \sum_{l=-N/2}^{N/2-1} \hat{u}_l e^{\imath \underline{l}
x_j}, \quad \,\, \forall \, j \in \, \boldsymbol{j}.
\label{_auto8} \tag{13}
\end{equation}
\]</div>
<p>Note that this differs from the definition used by, e.g.,
<a class="reference external" href="https://docs.scipy.org/doc/numpy-1.13.0/reference/routines.fft.html">Numpy</a>.</p>
<p>The inner products used in Eq. (<span class="xref myst">4</span>) may be
computed using forward FFTs (using weight functions <span class="math notranslate nohighlight">\(w=1/L\)</span>):</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto9"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{\hat{u}} =
\frac{1}{N^2}
\mathcal{F}_y\left(\mathcal{F}_x\left(\boldsymbol{u}\right)\right),
\label{_auto9} \tag{14}
\end{equation}
\]</div>
<p>From this we see that the variational forms
may be written in terms of the Fourier transformed <span class="math notranslate nohighlight">\(\hat{u}\)</span>. Expanding the
exact derivatives of the nabla operator, we have</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto10"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
(\nabla^2 u, v) =
\left(-(\underline{l}^2+\underline{m}^2)\hat{u}_{lm}\right), 
\label{_auto10} \tag{15}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<p><a id="_auto11"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
(\nabla^4 u, v) = \left((\underline{l}^2+\underline{m}^2)^2\hat{u}_{lm}\right), 
\label{_auto11} \tag{16}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<p><a id="_auto12"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
(|\nabla u|^2, v) = \left(\widehat{|\nabla u|^2}_{lm}\right),
\label{_auto12} \tag{17}
\end{equation}
\]</div>
<p>where the indices on the right hand side run over <span class="math notranslate nohighlight">\(\boldsymbol{l} \times \boldsymbol{m}\)</span>.
We find that the equation to be solved for each wavenumber can be found directly as</p>
<!-- Equation labels as ordinary links -->
<p><a id="eq:du_var3"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{\partial \hat{u}_{lm}}{\partial t}  =
\left(\underline{l}^2+\underline{m}^2 -
(\underline{l}^2+\underline{m}^2)^2\right)\hat{u}_{lm} - \widehat{|\nabla u|^2}_{lm},
\label{eq:du_var3} \tag{18}
\end{equation}
\]</div>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h2>
<p>The model equation (<span class="xref myst">1</span>) is implemented in shenfun using Fourier basis functions for
both <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> directions. We start the solver by implementing necessary
functionality from required modules like <a class="reference external" href="https://numpy.org">Numpy</a>, <a class="reference external" href="https://sympy.org">Sympy</a>
and <a class="reference external" href="https://matplotlib.org">matplotlib</a>, in
addition to <a class="reference external" href="https://github.com/spectralDNS/shenfun">shenfun</a>:</p>
<div class="cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">lambdify</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">shenfun</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<p>The size of the problem (in real space) is then specified, before creating
the <a class="reference external" href="https://shenfun.readthedocs.io/en/latest/shenfun.html#shenfun.tensorproductspace.TensorProductSpace">TensorProductSpace</a>, which is using a tensor product of two
one-dimensional Fourier function spaces. We also
create a <a class="reference external" href="https://shenfun.readthedocs.io/en/latest/shenfun.html#shenfun.tensorproductspace.VectorSpace">VectorSpace</a>, since this is required for computing the
gradient of the scalar field <code class="docutils literal notranslate"><span class="pre">u</span></code>. The gradient is required for the nonlinear
term.</p>
<div class="cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Size of discretization</span>
<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

<span class="n">K0</span> <span class="o">=</span> <span class="n">FunctionSpace</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">K1</span> <span class="o">=</span> <span class="n">FunctionSpace</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">TensorProductSpace</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="p">(</span><span class="n">K0</span><span class="p">,</span> <span class="n">K1</span><span class="p">),</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;planner_effort&#39;</span><span class="p">:</span> <span class="s1">&#39;FFTW_MEASURE&#39;</span><span class="p">})</span>
<span class="n">TV</span> <span class="o">=</span> <span class="n">VectorSpace</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>
<span class="n">Tp</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">get_dealiased</span><span class="p">((</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
<span class="n">TVp</span> <span class="o">=</span> <span class="n">VectorSpace</span><span class="p">(</span><span class="n">Tp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Test and trialfunctions are required for assembling the variational forms:</p>
<div class="cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>and some arrays are required to hold the solution. We also create an array
<code class="docutils literal notranslate"><span class="pre">gradu</span></code>, that will be used to compute the gradient in the nonlinear term.
Finally, the wavenumbers are collected in an array <code class="docutils literal notranslate"><span class="pre">K</span></code>. Here one feature is worth
mentioning. The gradient in spectral space can be computed as <code class="docutils literal notranslate"><span class="pre">1j*K*U_hat</span></code>.
However, since this is an odd derivative, and we are using an even number <code class="docutils literal notranslate"><span class="pre">N</span></code>
for the size of the domain, the highest wavenumber must be set to zero. This is
the purpose of the last keyword argument to <code class="docutils literal notranslate"><span class="pre">local_wavenumbers</span></code> below.</p>
<div class="cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;x,y&quot;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ue</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">ue</span><span class="p">)</span>
<span class="n">U_hat</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">U_hat</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">U_hat</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">get_mask_nyquist</span><span class="p">()</span>
<span class="n">U_hat</span><span class="o">.</span><span class="n">mask_nyquist</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">gradu</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">TVp</span><span class="p">)</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">local_wavenumbers</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">eliminate_highest_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">local_mesh</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that using this <code class="docutils literal notranslate"><span class="pre">K</span></code> in computing derivatives has the same effect as
achieved by symmetrizing the Fourier series by replacing the first sum below
with the second when computing odd derivatives.</p>
<!-- Equation labels as ordinary links -->
<p><a id="_auto13"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u  = \sum_{k=-N/2}^{N/2-1} \hat{u}_k e^{\imath k x}
\label{_auto13} \tag{19}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<p><a id="_auto14"></a></p>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u  = \sideset{}{'}\sum_{k=-N/2}^{N/2} \hat{u}_k e^{\imath k x}
\label{_auto14} \tag{20}
\end{equation}
\]</div>
<p>Here <span class="math notranslate nohighlight">\(\sideset{}{'}\sum\)</span> means that the first and last items in the sum are
divided by two. Note that the two sums are equal as they stand (due to aliasing), but only the
latter (known as the Fourier interpolant) gives the correct (zero) derivative of
the basis with the highest wavenumber.</p>
<p>Shenfun has a few integrators implemented in the <a class="reference external" href="https://shenfun.readthedocs.io/en/latest/shenfun.utilities.html#module-shenfun.utilities.integrators">shenfun.utilities.integrators</a>
submodule. Two such integrators are the 4th order explicit Runge-Kutta method
<code class="docutils literal notranslate"><span class="pre">RK4</span></code>, and the exponential 4th order Runge-Kutta method <code class="docutils literal notranslate"><span class="pre">ETDRK4</span></code>. Both these
integrators need two methods provided by the problem being solved, representing
the linear and nonlinear terms in the problem equation. We define two methods
below, called <code class="docutils literal notranslate"><span class="pre">LinearRHS</span></code> and <code class="docutils literal notranslate"><span class="pre">NonlinearRHS</span></code></p>
<div class="cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">LinearRHS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># Assemble diagonal bilinear forms</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">+</span><span class="n">div</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)))))</span>

<span class="k">def</span> <span class="nf">NonlinearRHS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">U_hat</span><span class="p">,</span> <span class="n">dU</span><span class="p">,</span> <span class="n">gradu</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># Assemble nonlinear term</span>
    <span class="n">gradu</span> <span class="o">=</span> <span class="n">TVp</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">K</span><span class="o">*</span><span class="n">U_hat</span><span class="p">,</span> <span class="n">gradu</span><span class="p">)</span>
    <span class="n">dU</span> <span class="o">=</span> <span class="n">Tp</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">gradu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">gradu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">gradu</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dU</span><span class="p">)</span>
    <span class="n">dU</span><span class="o">.</span><span class="n">mask_nyquist</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="n">dU</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">dU</span>
</pre></div>
</div>
</div>
</div>
<p>The code should, hopefully, be self-explanatory.</p>
<p>All that remains now is to setup the
integrator plus some plotting functionality for visualizing the results. Note
that visualization is only nice when running the code in serial. For parallel,
it is recommended to use <a class="reference external" href="https://shenfun.readthedocs.io/en/latest/mpi4py_fft.io.html#mpi4py_fft.io.h5py_file.HDF5File">HDF5File</a>, to store intermediate results to the HDF5
format, for later viewing in, e.g., Paraview.</p>
<p>We create an update function for plotting intermediate results with a
cool colormap:</p>
<div class="cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Integrate using an exponential time integrator</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_hat</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">tstep</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;fig&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;hot&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">U</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cm</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tstep</span> <span class="o">%</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;plot_step&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;plot_step&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u_hat</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cm</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy =&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now all that remains is to create the integrator and call it</p>
<div class="cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">par</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;plot_step&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;gradu&#39;</span><span class="p">:</span> <span class="n">gradu</span><span class="p">}</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">ETDRK4</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="n">LinearRHS</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">NonlinearRHS</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">,</span> <span class="o">**</span><span class="n">par</span><span class="p">)</span>
<span class="c1">#integrator = RK4(T, L=LinearRHS, N=NonlinearRHS, update=update, **par)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
<span class="n">U_hat</span> <span class="o">=</span> <span class="n">integrator</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">U_hat</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_time</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "mikaem/shenfun-demos",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="sphericalhelmholtz.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Demo - Helmholtz equation on the unit sphere</p>
      </div>
    </a>
    <a class="right-next"
       href="stokes.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Demo - Stokes equations</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-kuramato-sivashinsky-equation">The Kuramato-Sivashinsky equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-galerkin-method">Spectral Galerkin method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretization">Discretization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mikael Mortensen
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>